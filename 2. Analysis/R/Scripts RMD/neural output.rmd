---
title: "Neural output paper 1"
author: "Pieter Huycke"
date: "19/11/2020"
output: pdf_document
---

```{r setup, include=F}
knitr::opts_chunk$set(echo = F)

setwd("C:/Users/pieter/OneDrive - UGent/Projects/2019/overtraining - PILOT 3/figures/Publish/Data/Stimulus-locked/Theta, alpha, beta + behavioral data")
df = read.csv("theta_alpha_beta_behavioural.csv", 
              header = TRUE, sep = ",")
```

## General data manipulation

In the following block, we do some general manipulation on the dataset. We first check the data to see how it looks. Then we load in the relevant libraries for analysis. Finally, we convert some variables to factors.

```{r, label='general-manipulations', echo=F, results='hide',message=F}
# load needed libraries
library(car)
library(lme4)

# VARIABLE MANIPULATION  ---------

# see as certain predictors as factor
df$Block_overall       = factor(df$Block_overall)
df$Block_specific      = factor(df$Block_specific)
df$Repetitions_overall = factor(df$Repetitions_overall)
df$Repetitions_block   = factor(df$Repetitions_block)
df$Subject_nr          = factor(df$Subject_nr)

# set the Anova parameters
options(contrasts = c("contr.sum", "contr.poly"))
```

## Slow timescale: theta power

In the next part, we look at the neural effects on the slow timescale using `lmer()`. This is a follow-up analysis based on results obtained using a permutation test on the EEG data. In that analysis, we found that $\theta$ power significantly differed in the time window 250 to 400 ms after stimulus onset when comparing block 1 with block 8. We then averaged the $\theta$ power for each trial in this time window, and created a linear mixed effects model where we modelled $\theta$ as a function of block number and condition. Note that we removed both blocks 1 and block 8 to avoid double dipping. We remark that $\theta$ activity is defined by the power in the frequency band between 4 and 8 Hz. Finally, we highlight that in each model ```Subject_nr``` is included as a random effect, while the experimental parameters (such as block number, condition...) are included as fixed effects.

```{r, label='aov1', echo=T}
# remove the first and the last blocks to avoid double-dipping
df.reduced = df[(as.numeric(as.character(df$Block_specific)) > 1), ]
df.reduced = df.reduced[(as.numeric(as.character(df.reduced$Block_specific)) < 8), ]

# ------------------------------------------------------------------- #
# theta power ~ block number + condition + (block number x condition) #
# ------------------------------------------------------------------- #
theta.block_cond = lmer(Theta  ~ (1|Subject_nr) + Block_specific * Condition, 
                        data = df.reduced)
aov1 = Anova(theta.block_cond,
             type           = "III",
             test.statistic = "F")
aov1
```

## Fast timescale: alpha power

The investigation of neural effects on the fast timescale (i.e. as a function of stimulus repetitions) was also guided by the results of a permutation test on the EEG data. There, we found that $\alpha$ power significantly differed when comparing stimulus repetition 1 with stimulus repetition 8 in the time window between 700 and 850 ms. Therefore, we computed the mean $\alpha$ power in this time window for each subject. Then, we did a follow-up analysis where we modelled $\alpha$ power as a function of stimulus repetition. Note that we did this analysis only on the data where 1 < stimulus repetitions < 8. This to make sure that we avoided double dipping. We remark that $\alpha$ is defined by the frequency range 8 to 12 Hz.

```{r, label='aov2', echo=T}
# remove repetitions larger than 9
df.reduced = df[(as.numeric(as.character(df$Repetitions_overall)) < 9), ]

# make a subset for when repetitions <= 8
df.reduced = df[(as.numeric(as.character(df$Repetitions_block)) > 1), ]
df.reduced = df.reduced[(as.numeric(as.character(df.reduced$Repetitions_block)) < 8), ]

# ------------------------- #
# alpha power ~ repetitions #
# ------------------------- #
alpha.reps = lmer(Alpha ~ (1|Subject_nr) + Repetitions_block, 
                  data = df.reduced)
aov2 = Anova(alpha.reps,
             type           = "III",
             test.statistic = "Chisq")
aov2
```


## Fast timescale: beta power

In this same permutation test, we also found higher activation in the same time window as the $\alpha$ activity, but in the $\beta$ range (12 to 30 Hz). We decided to also compute the average $\beta$ power in this time window for each subject (in line with previous analyses), and build a linear mixed effects model. Here we also model $\beta$ power as a function of repetitions within a block.

```{r, label='aov3', echo=T}
# ------------------------ #
# beta power ~ repetitions #
# ------------------------ #
beta.reps = lmer(Beta ~ (1|Subject_nr) + Repetitions_block, 
                data = df.reduced)
aov3 = Anova(beta.reps,
             type           = "III",
             test.statistic = "Chisq")
aov3
```

## Follow-up analyses

We then switched the timescales, but held the independent variables constant. Thus, we investigate $\alpha$- and $\beta$ power on the slow timescale, and $\theta$ power on the fast timescale. Note that these are checks, since we found to $\theta$ fluctuations on the fast timescale using the permutation test. The same applies for $\alpha$ and $\beta$ on the slow timescale. 

We start by investigating whether ```reptitions within a block``` is a significant predictor of $\theta$ power. Thus, we investigate $\theta$ on the *fast timescale*. Note that the entire dataset is used, not a clipped version as used in previous analyses.

```{r, label='aov4', echo=T}
# ------------------------- #
# theta power ~ repetitions #
# ------------------------- #
# remove repetitions larger than 9
df.reduced = df[(as.numeric(as.character(df$Repetitions_overall)) < 9), ]

theta.reps = lmer(Theta ~ (1|Subject_nr) + Repetitions_block, 
                  data = df.reduced)
aov4 = Anova(theta.reps,
             type           = "III",
             test.statistic = "Chisq")
aov4
```

Our next step is to investigate $\alpha$ power as a function of repetitions within a block and condition. This allows us to make a plot similar to the one for $\theta$ on the slow timescale. The difference is that we look here at $\alpha$ on the fast timescale, but now with a condition split (and thus on the entire dataset, not on a subset). We investigate the main effects of within block repetitions, condition, and a possible interaction effect on $\alpha$ power.

```{r, label='aov5', echo=T}
# ----------------------------------------------------------------- #
# alpha power ~ repetitions + condition + (repetitions x condition) #
# ----------------------------------------------------------------- #
alpha.reps_cond = lmer(Alpha  ~ (1|Subject_nr) + Repetitions_block * Condition, 
                       data = df)
aov5 = Anova(alpha.reps_cond,
             type           = "III",
             test.statistic = "F")
aov5
```

Then, we investigate whether ```block number``` and ```condition``` are significant predictors of $\alpha$ power. Thus, $\alpha$ power on the *slow timescale*.

```{r, label='aov6', echo=T}
# ------------------------------------------------------------------- #
# alpha power ~ block number + condition + (block number x condition) #
# ------------------------------------------------------------------- #
alpha.block_cond = lmer(Alpha  ~ (1|Subject_nr) + Block_specific * Condition, 
                        data = df)
aov6 = Anova(alpha.block_cond,
             type           = "III",
             test.statistic = "Chisq")
aov6
```

Finally, we investigate whether ```block number``` and ```condition``` are significant predictors of $\beta$ power. So, $\beta$ power on the *slow timescale*.

```{r, label='aov7', echo=T}
# ------------------------------------------------------------------- #
# beta power ~ block number + condition + (block number x condition) #
# ------------------------------------------------------------------- #
beta.block_cond = lmer(Beta  ~ (1|Subject_nr) + Block_specific * Condition, 
                       data = df)
aov7 = Anova(beta.block_cond,
             type           = "III",
             test.statistic = "Chisq")
aov7
```


